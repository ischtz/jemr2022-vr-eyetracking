# Eye Tracking in Virtual Reality: Vive Pro Eye Spatial Accuracy, Precision, and Calibration Reliability


This repository contains the experiment code, data, and analysis for our 2022 manuscript in the *Journal of Eye Movement Research* (Schuetz & Fiehler, 2022). 

## Experiment Code

The experiment was implemented in Python using WorldViz Vizard and [our *vexptoolbox* software toolbox](https://github.com/ischtz/vizard-experiment-toolbox) designed to aid in developing behavioral experiments on the Vizard platform. It can be run by opening *gaze_evaluation.py* within Vizard and pressing F5 or clicking the *Run* button. Currently, only the Vive Pro Eye built-in eye tracker is fully supported, but there is limited support for the Pupil Labs HTC Vive Add-On and the code can also be run without an eye tracker or VR headset connected. 

The experiment first calibrates the chosen eye tracker, then presents 74 head-locked target positions across two distances (6 m and 0.5 m), spanning a range of +/- 15 degrees at 6 m and +/- 10 degrees at 0.5 m. After all targets have been displayed, a JSON file with raw gaze angle data and computed metrics is output (see below).


## Summary of Results

We found that participants (N=18) could be calibrated reliably, including those wearing contact lenses or glasses (*left figure*). On average, participants achieved a spatial accuracy of 1.1Â°, with higher accuracy (lower angular error) for more central compared to peripheral targets (*right figure*). 

![figure5_small](https://user-images.githubusercontent.com/7711674/186172277-9f3b5201-9fa4-4243-b995-f3e047429d14.png) ![figure4_small](https://user-images.githubusercontent.com/7711674/186172296-a814b13d-bac8-4bc1-9c6a-71e0e63c4e78.png)

Please refer to the paper for detailed results, where we also statistically evaluate the effect of vision correction (contact lenses, glasses, or no correction) and estimate participants' inter-pupillary distance using the pupil positions detected by the eye tracker. 


## Data Format

Data are stored in JSON format, one file per session of each participant. These files are generated by exporting vexptoolbox's [*ValidationResult*](https://github.com/ischtz/vizard-experiment-toolbox/blob/6f0e52407aaa3ba3ecdcb385d0f57611226f16f8/vexptoolbox/data.py#L262) object and contain sample and metric data at different levels of aggregation: 

- **samples**: Raw sample data recorded at 90 Hz, one list entry per target, then one dictionary per sample. Important fields include: 
  - *time*: Vizard 3d engine time stamp, in ms
  - *systime*: Python system time stamp, in ms
  - *frameno*: Vizard rendering frame count
  - *view_posX/Y/Z*: Headset position in world space, in meters
  - *tracker_posX/Y/Z*: Combined gaze origin in tracker space (relative to HMD origin)
  - *gaze_posX/Y/Z*: Combined gaze origin in world space
  - *trackVec_X/Y/Z*: Gaze unit vector in tracker space
  - *gazeVec_X/Y/Z*: Gaze unit vector in world space
  - *targetErr*: Angular error between gaze and eye-target vector
  - *targetErr_L/R*: Angular error between gaze and eye-target vector, monocular
  - *targetGaze_X*/*targetGaze_Y*: Horizontal / vertical gaze angle relative to eye-target vector

- **targets**: Target information in order of presentation and metrics aggregated for each target: 
  - *x*, *y*: Horizontal and vertical target angle relative to the center of the visual field
  - *xm*, *ym*: Horizontal and vertical target position in meters, relative to HMD origin
  - *d*: Target distance in meters
  - *set_no*: Target number in the original target set before randomization
  - *ipd*: Average inter-pupillary distance for this target, in tracker space (mm)
  - *avgX*, *avgY*: Average horizontal and vertical gaze angles
  - *offX*, *offY*: Average absolute angular gaze error to target
  - *acc*: Average accuracy (mean of absolute angular gaze error to target)
  - *medacc*: Median accuracy (median of absolute angular gaze error to target)
  - *sd*: Average SD precision (standard deviation of gaze error)
  - *rmsi*: Inter-sample RMS (root mean square) precision

- **metadata**: Dictionary of participant metadata, only filled in for the first session of each participant:
  - Standard demographics (age, gender, participant code)
  - Type of vision correction and prescription info
  - (Note that HMD used and measured inter-pupillary distance were measured post-hoc and can be found in the [preprocessing notebook](https://github.com/ischtz/jemr2022-vr-eyetracking/blob/main/analysis/Analysis1_PreprocHistograms.ipynb)).

In addition, the following **aggregated metrics across all targets** of the session are stored in the top-level JSON data:
  - *acc*: Average accuracy (mean of absolute angular gaze error to target)
  - *sd*: Average SD precision (standard deviation of gaze error)
  - *rmsi*: Inter-sample RMS (root mean square) precision
  - *ipd*: Average inter-pupillary distance across targets

All metrics are further provided for the horizontal and vertical gaze direction as well as monocularly, using the format: `<metric><direction>_<eye>`, i.e. horizontal accuracy for the left monocular gaze vector becomes `accX_L`.

**Note** that metrics are recomputed by the analysis script, e.g. to select a sample time range and filter outlier trials as described in the paper, therefore raw values from the JSON files may not exactly match the reported results.


## Citation

If you use any data or code from this repository, please cite the corresponding manuscript (Link will be added here after publication): 

*Schuetz, I. & Fiehler, K. (2022). Eye Tracking in Virtual Reality: Vive Pro Eye Spatial Accuracy, Precision, and Calibration Reliability. Journal of Eye Movement Research, 15(3):3. https://doi.org/10.16910/jemr.15.3.3*

Citation in BibTeX format:
```
@Article{Schuetz2022JEMR,
  author       = {Schuetz, I. and Fiehler, K.},
  journal      = {Journal of Eye Movement Research},
  title        = {Eye Tracking in Virtual Reality: Vive Pro Eye Spatial Accuracy, Precision, and Calibration Reliability},
  year         = {2022},
  issn         = {1995-8692},
  number       = {3},
  pages        = {3},
  volume       = {15},
  doi          = {10.16910/jemr.15.3.3}
}
```


